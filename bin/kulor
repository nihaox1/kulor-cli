#!/usr/bin/env node  
"use strict";

process.title   = "kulor";

var baseUrl = __dirname ,
    grunt   = require( "grunt" ),
    nopt    = require( "nopt" ),
    log     = require( "../util/log" ),
    cmds    = require( baseUrl + "/../util/cmds" );

function kulor( libFolder ){
    this.options = {
        baseFolder  : libFolder + "/../" ,
        hasInit     : false ,
        inputOpts   : nopt( cmds.options , cmds.shortOpts , process.argv , 2 )
    };
    this.cwd        = process.cwd() + "/";
    this.bowerDir   = this.cwd + "bower_components/";
}

kulor.fn = kulor.prototype;

kulor.fn.require = function( moduleName , newoduleName ){
    this[ newoduleName || moduleName ] = require( this.options.baseFolder + "lib/" + moduleName );
    return this;
};

kulor.fn.init = function(){
    var _cmd, _args;
    this.packageJson    = JSON.parse( grunt.file.read( this.options.baseFolder + "package.json" ) );
    if( process.argv.length >= 3 ){
        _cmd = cmds.cmd[ process.argv[ 2 ] ];
        if( this.options.inputOpts.help ) {
            _cmd    = "help";
        }
        if( _cmd == "version" ){
            log( "kulor version :" + this.packageJson.version );
        } else if( _cmd ){
            this.require( _cmd );
            this[ _cmd ].apply( this );
        } else {
            log( "Error commend input , run \"kulor -h\" for more" );
        }
    } else {
        log( "run \"kulor -h\" for more" );
    }
};

new kulor( baseUrl ).init();